# 商品分类页面实现计划

## 实现目标
根据提供的Compose页面代码，实现相同界面的Flutter版本，要求：
- AppBar效果与首页一致：上滑进入，下拉出来
- FilterBar吸顶不隐藏
- FilterBar右侧menu按钮随AppBar隐藏而动画显示/隐藏
- 筛选按钮点击时从按钮位置动画弹出FilterDialog
- 使用自定义ScrollbarRefreshLayout布局
- 内容区域根据menu按钮切换瀑布流或ListView
- 复用首页瀑布流item布局

## 实现步骤

### 1. 创建页面文件结构
- `lib/features/goods/view/goods_category_screen.dart` - 主页面
- `lib/features/goods/state/goods_category_state.dart` - 状态管理
- `lib/features/goods/widget/filter_bar.dart` - 筛选栏组件
- `lib/features/goods/widget/filter_dialog.dart` - 筛选弹窗
- `lib/features/goods/model/sort_type.dart` - 排序类型枚举
- `lib/features/goods/model/sort_state.dart` - 排序状态类

### 2. 实现状态管理（GoodsCategoryState）
- 继承ChangeNotifier
- 包含RefreshController用于刷新
- 管理商品列表数据
- 管理排序状态（SortState）
- 管理视图切换状态（瀑布流/列表）
- 管理筛选弹窗显示状态

### 3. 实现主页面布局
- 使用Scaffold + Consumer模式
- 外层使用ScrollbarRefreshLayout
- AppBar和FilterBar放在sliverAppBars中
- 内容区域根据视图类型切换：
  - 瀑布流：直接复用首页的`GoodsWaterfallFlow`组件
  - 列表：使用ListView.builder，item直接复用首页推荐商品的item布局

### 4. 实现FilterBar组件
- 包含排序按钮和筛选按钮
- 右侧menu按钮随AppBar滚动动画显示/隐藏
- 点击排序按钮切换排序方式
- 点击筛选按钮显示FilterDialog
- 点击menu按钮切换视图类型

### 5. 实现FilterDialog组件
- 从按钮位置动画弹出
- 包含具体筛选内容
- 支持多级筛选
- 点击确定/重置按钮更新筛选状态

### 6. 实现动画效果
- AppBar滚动动画（与首页一致）
- menu按钮的显示/隐藏动画
- FilterDialog弹出动画

## 技术要点

1. **布局结构**：使用NestedScrollView嵌套SmartRefresher实现下拉刷新和AppBar滚动效果
2. **状态管理**：使用Provider + ChangeNotifier管理页面状态
3. **动画实现**：使用AnimatedContainer实现menu按钮的平滑显示/隐藏
4. **弹窗动画**：使用自定义动画实现FilterDialog从按钮位置弹出的效果
5. **组件复用**：
   - 直接复用`GoodsWaterfallFlow`组件实现瀑布流
   - 直接复用首页推荐商品的item布局实现ListView

## 预期效果
- 与Compose版本相同的视觉效果和交互体验
- 流畅的滚动和动画效果
- 响应式布局，适配不同屏幕尺寸
- 高效复用现有组件，保持代码一致性